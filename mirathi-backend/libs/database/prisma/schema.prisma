datasource db {
  provider = "postgresql"
}

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}
// -----------------------------------------------------------------------------
// ENUMS
// -----------------------------------------------------------------------------
enum UserRole {
  USER
  ADMIN
  VERIFIER
  AUDITOR
}
enum Gender {
  MALE
  FEMALE
  OTHERS
}
enum DocumentStatus {
  PENDING_UPLOAD
  PENDING_VERIFICATION
  VERIFIED
  REJECTED
  EXPIRED
}
enum ReferenceType {
  TITLE_DEED
  NATIONAL_ID
  DEATH_CERTIFICATE
  BIRTH_CERTIFICATE
  MARRIAGE_CERTIFICATE
  KRA_PIN
  OTHER
}
enum AssetCategory {
  LAND              // Title deeds, plots
  PROPERTY          // Houses, apartments, commercial buildings
  VEHICLE           // Cars, motorcycles, tractors
  BANK_ACCOUNT      // Savings, current accounts
  INVESTMENT        // Shares, bonds, SACCOs, M-Akiba
  BUSINESS          // Business ownership, partnerships
  LIVESTOCK         // Cattle, goats, poultry (very Kenyan!)
  PERSONAL_EFFECTS  // Jewelry, furniture, electronics
  OTHER
}
enum AssetStatus {
  ACTIVE           // Normal state
  VERIFIED         // User has uploaded proof
  ENCUMBERED       // Has mortgage/charge
  DISPUTED         // Someone is contesting ownership
  LIQUIDATED       // Sold/converted to cash
}
enum LandCategory {
  RESIDENTIAL      // Home, apartment
  AGRICULTURAL     // Farm, shamba
  COMMERCIAL       // Shop, office building
  INDUSTRIAL       // Factory, warehouse
  VACANT           // Undeveloped plot
}
enum VehicleCategory {
  PERSONAL_CAR
  COMMERCIAL_VEHICLE  // Matatu, lorry
  MOTORCYCLE
  TRACTOR
}
enum DebtCategory {
  MORTGAGE
  BANK_LOAN
  SACCO_LOAN
  PERSONAL_LOAN
  MOBILE_LOAN        // Fuliza, M-Shwari, Tala (very Kenyan!)
  FUNERAL_EXPENSES
  MEDICAL_BILLS
  TAXES_OWED
  OTHER
}
enum DebtPriority {
  CRITICAL          // Funeral, taxes (S.45 LSA)
  HIGH              // Secured debts (mortgages)
  MEDIUM            // Priority unsecured
  LOW               // General unsecured
}
enum DebtStatus {
  OUTSTANDING
  PARTIALLY_PAID
  PAID_IN_FULL
  DISPUTED
  WRITTEN_OFF
}
enum WillStatus {
  DRAFT             // Being created
  ACTIVE            // Current valid will
  SUPERSEDED        // Replaced by newer will
  REVOKED           // Cancelled
  EXECUTED          // Person has died
}
enum BeneficiaryType {
  SPOUSE
  CHILD
  PARENT
  SIBLING
  FRIEND
  CHARITY
  OTHER
}
enum BequestType {
  SPECIFIC_ASSET    // "My land in Kiambu goes to John"
  PERCENTAGE        // "30% of everything goes to Mary"
  CASH_AMOUNT       // "KES 500,000 to my church"
  RESIDUAL          // "Everything else goes to..."
}
enum WitnessStatus {
  PENDING           // Not yet signed
  SIGNED            // Has witnessed
  DECLINED          // Refused to witness
}
enum RoadmapPhase {
  PRE_FILING
  FILING
  CONFIRMATION
  DISTRIBUTION
  CLOSURE
}
enum TaskStatus {
  LOCKED
  PENDING
  IN_PROGRESS
  COMPLETED
  SKIPPED
  WAIVED
  BLOCKED
  FAILED
}
enum ProbateApplicationType {
  GRANT_OF_PROBATE
  LETTERS_OF_ADMINISTRATION
  LETTERS_OF_ADMIN_WILL_ANNEXED
  SUMMARY_ADMINISTRATION
  LIMITED_GRANT_AD_LITEM
  LIMITED_GRANT_COLLECTION
  ISLAMIC_GRANT
  CUSTOMARY_GRANT
}
enum CourtJurisdiction {
  HIGH_COURT
  MAGISTRATE_COURT
  KADHIS_COURT
  CUSTOMARY_COURT
  FAMILY_DIVISION
  COMMERCIAL_COURT
}
enum CasePriority {
  URGENT
  HIGH
  NORMAL
  LOW
}
enum FilingConfidence {
  HIGH
  MEDIUM
  LOW
  VERY_LOW
  BLOCKED
}
enum RoadmapStatus {
  DRAFT
  ACTIVE
  PAUSED
  BLOCKED
  COMPLETED
  ABANDONED
  ESCALATED
}
enum TaskPriority {
  CRITICAL
  HIGH
  MEDIUM
  LOW
}
enum TaskTrigger {
  MANUAL
  AUTOMATIC
  EVENT_DRIVEN
  SCHEDULED
  READINESS_BASED
}
enum ProofType {
  DOCUMENT_UPLOAD
  DIGITAL_SIGNATURE
  SMS_VERIFICATION
  EMAIL_VERIFICATION
  COURT_RECEIPT
  BANK_SLIP
  WITNESS_SIGNATURE
  AFFIDAVIT
}
enum TaskCategory {
  IDENTITY_VERIFICATION
  FAMILY_STRUCTURE
  GUARDIANSHIP
  ASSET_DISCOVERY
  DEBT_SETTLEMENT
  DOCUMENT_COLLECTION
  DOCUMENT_VALIDATION
  CUSTOMARY_DOCUMENTS
  FORM_GENERATION
  FORM_REVIEW
  SIGNATURE_COLLECTION
  COURT_SELECTION
  FEE_PAYMENT
  LODGEMENT
  GAZETTE_PUBLICATION
  COURT_ATTENDANCE
  GRANT_ISSUANCE
  GRANT_CONFIRMATION
  ASSET_TRANSFER
  DEBT_PAYMENT
  TAX_CLEARANCE
  FINAL_ACCOUNTS
  ESTATE_CLOSURE
  BENEFICIARY_NOTIFICATION
  WILL_SPECIFIC
  ISLAMIC_SPECIFIC
  POLYGAMOUS_SPECIFIC
  MINOR_SPECIFIC
  DISPUTE_RESOLUTION
}
enum RiskSourceType {
  FAMILY_SERVICE
  GUARDIANSHIP_SERVICE
  MARRIAGE_SERVICE
  ESTATE_SERVICE
  WILL_SERVICE
  ASSET_SERVICE
  DEBT_SERVICE
  COMPLIANCE_ENGINE
  READINESS_ASSESSMENT
  FORM_STRATEGY
  DOCUMENT_SERVICE
  KRA_SERVICE
  LANDS_REGISTRY
  NTSA_SERVICE
  USER_INPUT
  SYSTEM_VALIDATION
  THIRD_PARTY_API
}
enum DetectionMethod {
  RULE_ENGINE
  API_VALIDATION
  MANUAL_REVIEW
  SYSTEM_SCAN
  EVENT_DRIVEN
  CROSS_CONTEXT_CHECK
  LEGAL_ANALYSIS
  DATA_INTEGRITY_CHECK
}
enum ResolutionTrigger {
  EVENT_BASED
  MANUAL_ACTION
  SYSTEM_AUTO
  COURT_ORDER
  TIME_BASED
}
enum KenyanFormType {
  // Primary
  PA1_PETITION
  PA5_PETITION_SUMMARY
  PA80_PETITION_INTESTATE
  PA81_PETITION_ADMINISTRATION
  ISLAMIC_PETITION
  // Supporting
  PA12_AFFIDAVIT_MEANS
  AFFIDAVIT_DUE_EXECUTION
  AFFIDAVIT_OF_SEARCH
  AFFIDAVIT_OF_IDENTIFICATION
  AFFIDAVIT_SUPPORTING_POLYGAMY
  ISLAMIC_AFFIDAVIT
  // Consents & Guarantees
  PA38_CONSENT
  PA57_GUARANTEE
  ISLAMIC_CONSENT
  CONSENT_MINOR
  CONSENT_CREDITOR
  // Customary
  CHIEFS_LETTER_TEMPLATE
  ELDERS_AFFIDAVIT
  // Output Documents
  GRANT_OF_PROBATE
  GRANT_LETTERS_ADMINISTRATION
  CONFIRMATION_GRANT
}
enum ApplicationStatus {
  DRAFT
  PENDING_FORMS
  UNDER_REVIEW
  PENDING_SIGNATURES
  PENDING_CONSENTS
  PENDING_FEE
  READY_TO_FILE
  FILED
  COURT_REVIEW
  GAZETTE_PUBLISHED
  GRANTED
  REJECTED
  AMENDMENT_REQUIRED
  WITHDRAWN
  ABANDONED
}
enum FilingPriority {
  URGENT
  HIGH
  NORMAL
  LOW
}
enum FormStatus {
  PENDING_GENERATION
  GENERATED
  UNDER_REVIEW
  APPROVED
  SIGNATURE_PENDING
  SIGNED
  FILED
  COURT_ACCEPTED
  COURT_REJECTED
  AMENDED
  SUPERSEDED
  ARCHIVED
}
enum FormCategory {
  PRIMARY_PETITION
  SUPPORTING_AFFIDAVIT
  CONSENT
  GUARANTEE
  NOTICE
  SCHEDULE
  COURT_ORDER
  CUSTOMARY
  ISLAMIC
  DISTRIBUTION
}
enum StorageProvider {
  AWS_S3
  AZURE_BLOB
  GOOGLE_CLOUD_STORAGE
  LOCAL_FILE_SYSTEM
  COURT_E_FILING
}
enum FileFormat {
  PDF
  DOCX
  XML
  HTML
  JSON
}
enum ConsentStatus {
  PENDING
  GRANTED
  DECLINED
  NOT_REQUIRED
  EXPIRED
  WITHDRAWN
}
enum RiskCategory {
  // Document Issues
  MISSING_DOCUMENT
  INVALID_DOCUMENT
  EXPIRED_DOCUMENT
  FORGED_DOCUMENT
  // Family Structure
  MINOR_WITHOUT_GUARDIAN
  UNDEFINED_POLYGAMOUS_STRUCTURE
  DISPUTED_RELATIONSHIP
  COHABITATION_CLAIM
  ILLEGITIMATE_CHILD_CLAIM
  // Estate Issues
  ASSET_VERIFICATION_FAILED
  INSOLVENT_ESTATE
  MISSING_ASSET_VALUATION
  ENCUMBERED_ASSET
  FRAUDULENT_ASSET_TRANSFER
  // Will Issues
  INVALID_WILL_SIGNATURE
  MINOR_EXECUTOR
  BENEFICIARY_AS_WITNESS
  CONTESTED_WILL
  UNDUE_INFLUENCE
  // Jurisdiction
  WRONG_COURT
  NON_RESIDENT_APPLICANT
  FORUM_NON_CONVENIENS
  // Tax & Compliance
  TAX_CLEARANCE_MISSING
  KRA_PIN_MISSING
  CAPITAL_GAINS_TAX_UNPAID
  // Time-Based
  STATUTE_BARRED_DEBT
  DELAYED_FILING
  // Other
  FAMILY_DISPUTE
  CRIMINAL_INVESTIGATION
  BANKRUPTCY_PENDING
  // System
  DATA_INCONSISTENCY
  EXTERNAL_API_FAILURE
}
enum RiskStatus {
  ACTIVE
  RESOLVED
  SUPERSEDED
  EXPIRED
  DISPUTED
}
enum ConsentMethod {
  SMS_OTP
  EMAIL_LINK
  DIGITAL_SIGNATURE
  WET_SIGNATURE
  BIOMETRIC
  WITNESS_MARK
  IN_PERSON
}
enum FamilyRole {
  SURVIVING_SPOUSE
  ADULT_CHILD
  MINOR_CHILD
  GUARDIAN_OF_MINOR
  BENEFICIARY
  EXECUTOR
  ADMINISTRATOR
  PARENT
  SIBLING
  OTHER_RELATIVE
}
enum ResolutionMethod {
  EVENT_DRIVEN
  MANUAL_RESOLUTION
  SYSTEM_AUTO_RESOLVE
  COURT_ORDER
  TIME_BASED
  ADMIN_OVERRIDE
}
enum SuccessionRegime {
  TESTATE              // Valid Will exists
  INTESTATE            // No Will
  PARTIALLY_INTESTATE  // Will exists but doesn't cover all assets
  CUSTOMARY            // Managed by elders (rare but valid)
}
enum SuccessionMarriageType {
  MONOGAMOUS
  POLYGAMOUS           // Triggers S.40 Logic
  COHABITATION         // Triggers S.3(5) & S.29 Logic (Likely Dispute)
  SINGLE
}
enum SuccessionReligion {
  STATUTORY            // Law of Succession Act (General)
  ISLAMIC              // Subject to Sharia (Kadhi's Court)
  HINDU                // Hindu Succession Act
  AFRICAN_CUSTOMARY    // Customary Law
  CHRISTIAN            // Often Statutory
}
enum RiskSeverity {
  CRITICAL             // Cannot file (e.g. No Death Cert)
  HIGH                 // Likely dispute
  MEDIUM               // Warning
  LOW                  // Info
}
enum RiskSource {
  FAMILY_SERVICE       // e.g. "Found a minor child with no guardian"
  ESTATE_SERVICE       // e.g. "Asset value requires higher court"
  WILL_SERVICE         // e.g. "Will witness is also a beneficiary"
  DOCUMENT_SERVICE     // e.g. "ID scan is blurry"
  EXTERNAL_REGISTRY    // e.g. "KRA PIN is inactive"
}
enum ReadinessStatus {
  IN_PROGRESS
  READY_TO_FILE
  BLOCKED
}
enum RelationshipType {
  SELF              // The user themselves
  FATHER
  MOTHER
  SPOUSE
  CHILD
  ADOPTED_CHILD
  SIBLING
  HALF_SIBLING      // Same father or mother, different other parent
}
enum RelationshipGuardianshipType {
  TEMPORARY
  PERMANENT
  TESTAMENTARY
  CUSTOMARY
}
enum MarriageType {
  CIVIL
  CHRISTIAN
  CUSTOMARY
  ISLAMIC
  HINDU
  OTHER
}
enum MarriageStatus {
  ACTIVE
  DIVORCED
  ANNULLED
  WIDOWED
}
enum KenyanRelationshipCategory {
  SPOUSE
  CHILDREN
  PARENTS
  SIBLINGS
  EXTENDED_FAMILY
  NON_FAMILY
}
enum DependencyLevel {
  NONE
  PARTIAL
  FULL
}
enum KenyanLawSection {
  S26_DEPENDANT_PROVISION
  S29_DEPENDANTS
  S35_SPOUSAL_CHILDS_SHARE
  S40_POLY_GAMY
  S45_DEBT_PRIORITY
  S70_TESTAMENTARY_GUARDIAN
  S71_COURT_GUARDIAN
  S72_GUARDIAN_BOND
  S73_GUARDIAN_ACCOUNTS
  S83_EXECUTOR_DUTIES
}
enum GuardianReportStatus {
  PENDING
  DUE
  SUBMITTED
  APPROVED
  OVERDUE
  REJECTED
}
enum GuardianshipStatus {
  DRAFT             // Form started
  PENDING_REVIEW    // Checklist submitted
  ELIGIBLE          // Passed all checks
  CONDITIONAL       // Passed with warnings
  INELIGIBLE        // Failed critical checks
  ACTIVE            // Approved and active
  SUSPENDED         // Temporarily paused
  TERMINATED        // Ended
}
enum VerificationStatus {
  UNVERIFIED
  PENDING
  VERIFIED
  DISPUTED
  REJECTED
}
enum BondStatus {
  NOT_REQUIRED
  REQUIRED_PENDING
  POSTED
  FORFEITED
}
enum GuardianRole {
  CARETAKER
  PROPERTY_MANAGER
  EDUCATIONAL_GUARDIAN
  MEDICAL_CONSENT
  LEGAL_REPRESENTATIVE
  EMERGENCY
  CUSTOMARY
}
enum GuardianAssignmentStatus {
  PENDING
  ACTIVE
  SUSPENDED
  TERMINATED
  REVOKED
  DECEASED
  RESIGNED
}
enum GuardianshipJurisdiction {
  STATUTORY
  ISLAMIC
  CUSTOMARY
  INTERNATIONAL
}
enum CompliancePeriod {
  QUARTER_1
  QUARTER_2
  QUARTER_3
  QUARTER_4
  ANNUAL
  BIANNUAL
  SPECIAL
}
enum ComplianceCheckStatus {
  DRAFT
  PENDING_SUBMISSION
  SUBMITTED
  UNDER_REVIEW
  ACCEPTED
  REJECTED
  AMENDMENT_REQUESTED
  OVERDUE
  EXTENSION_GRANTED
  WAIVED
}
enum ValidationStatus {
  PENDING
  IN_PROGRESS
  PASSED
  FAILED
  EXCEPTION
}
enum ReportType {
  ANNUAL_WELFARE
  QUARTERLY_FINANCIAL
  MEDICAL_UPDATE
  EDUCATIONAL_PROGRESS
  PROPERTY_MANAGEMENT
  COURT_MANDATED
  EMERGENCY_REPORT
  CLOSING_REPORT
}
enum GuardianAppointmentSource {
  WILL
  COURT
  FAMILY_AGREEMENT
  CUSTOMARY_COUNCIL
  EMERGENCY
  MUTUAL
}
enum GuardianshipTerminationReason {
  WARD_REACHED_MAJORITY
  WARD_DECEASED
  GUARDIAN_DECEASED
  GUARDIAN_INCAPACITATED
  COURT_REMOVAL
  VOLUNTARY_RESIGNATION
  WARD_REGAINED_CAPACITY
  ADOPTION_FINALIZED
  CUSTOMARY_TRANSFER
}
enum AdoptionType {
  STATUTORY
  CUSTOMARY
  INTERNATIONAL
  KINSHIP
  FOSTER_TO_ADOPT
  STEP_PARENT
  RELATIVE
}
enum AdoptionStatus {
  PENDING
  IN_PROGRESS
  FINALIZED
  REVOKED
  ANNULED
  APPEALED
}
enum CohabitationType {
  COME_WE_STAY
  LONG_TERM_PARTNERSHIP
  DATING
  ENGAGED
}
enum ParentalConsentStatus {
  CONSENTED
  WITHHELD
  UNKNOWN
  DECEASED
  TERMINATED
}
enum CohabitationStability {
  STABLE
  VOLATILE
  ON_OFF
  UNKNOWN
}
enum RelationshipVerificationLevel {
  UNVERIFIED
  PARTIALLY_VERIFIED
  FULLY_VERIFIED
  DISPUTED
}
enum ConflictResolutionStatus {
  RESOLVED
  PENDING
  MEDIATION
  COURT
}
enum HouseEstablishmentType {
  CUSTOMARY
  ISLAMIC
  TRADITIONAL
  COURT_RECOGNIZED
}
enum HouseDissolutionReason {
  WIFE_DECEASED
  WIFE_DIVORCED
  HOUSE_MERGED
  COURT_ORDER
}
enum RelationshipVerificationMethod {
  DNA
  DOCUMENT
  FAMILY_CONSENSUS
  COURT_ORDER
  TRADITIONAL
}
enum InheritanceRightLevel {
  FULL
  LIMITED
  NONE
  DISPUTED
}
enum RelationshipSupportType {
  FINANCIAL
  HOUSING
  MEDICAL
  EDUCATIONAL
  FULL_CARE
}
enum GuardianType {
  TESTAMENTARY      // Appointed by Will (S.70 LSA) - stored here as fact
  COURT_APPOINTED   // Appointed by Children's Court
  CUSTOMARY         // Recognized by clan elders
  NATURAL_PARENT    // Default
}
enum InheritanceRights {
  FULL              // Full statutory rights
  PARTIAL           // Reduced rights (e.g., stepchild)
  CUSTOMARY         // Customary law applies
  NONE              // Explicitly excluded
  PENDING           // Awaiting court determination
}
enum ComplianceStatus {
  PENDING
  FILED
  OVERDUE
  REJECTED
}
enum EstateStatus {
  SETUP
  ACTIVE
  FROZEN
  LIQUIDATING
  READY_FOR_DISTRIBUTION
  DISTRIBUTING
  CLOSED
}
enum LiquidationType {
  PRIVATE_TREATY
  PUBLIC_AUCTION
  SALE_TO_BENEFICIARY
  BUYBACK
  MARKET_SALE
}
enum LiquidationStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  LISTED_FOR_SALE
  AUCTION_SCHEDULED
  AUCTION_IN_PROGRESS
  SALE_PENDING
  SALE_COMPLETED
  PROCEEDS_RECEIVED
  DISTRIBUTED
  CLOSED
  CANCELLED
  FAILED
  EXPIRED
}
enum TaxStatus {
  PENDING
  ASSESSED
  PARTIALLY_PAID
  CLEARED
  EXEMPT
  DISPUTED
}
enum CoOwnershipType {
  JOINT_TENANCY
  TENANCY_IN_COMMON
}
enum ValuationSource {
  MARKET_ESTIMATE
  REGISTERED_VALUER
  GOVERNMENT_VALUER
  CHARTERED_SURVEYOR
  INSURANCE_VALUATION
  AGREEMENT_BY_HEIRS
  COURT_DETERMINATION
}
enum WillType {
  STANDARD
  JOINT_WILL
  MUTUAL_WILL
  HOLOGRAPHIC
  INTERNATIONAL
  TESTAMENTARY_TRUST_WILL
}
enum RevocationMethod {
  NEW_WILL                // Superseded by new will
  CODICIL                 // Amendment
  DESTRUCTION             // Physical destruction
  COURT_ORDER             // Court-ordered revocation
  MARRIAGE                // Marriage revokes prior will (common law)
  DIVORCE                 // Divorce may affect will
  OTHER
}
enum ExecutorType {
  USER
  FAMILY_MEMBER
  EXTERNAL
}
enum AppointmentType {
  TESTAMENTARY
  SPECIAL_EXECUTOR
}
enum VerificationMethod {
  NATIONAL_ID
  PASSPORT
  DRIVERS_LICENSE
  BIRTH_CERTIFICATE
  ALIEN_CARD
  MILITARY_ID
  OTHER
}
enum CodicilAmendmentType {
  ADDITION
  MODIFICATION
  REVOCATION
}
enum DisinheritanceReasonCategory {
  ESTRANGEMENT
  PROVIDED_FOR_DURING_LIFE
  MORAL_UNWORTHINESS
  CONFLICT_OF_INTEREST
  FINANCIAL_INDEPENDENCE
  OTHER_DISPOSITION
  TESTATOR_DISCRETION
}
enum DisinheritanceEvidenceType {
  AFFIDAVIT
  WILL_CLARIFICATION
  PRIOR_GIFT_DOCUMENTATION
  FAMILY_AGREEMENT
  COURT_ORDER
  MEDICAL_REPORT
  OTHER
}
enum WillStorageLocation {
  SAFE_DEPOSIT_BOX
  LAWYER_OFFICE
  HOME_SAFE
  DIGITAL_VAULT
  COURT_REGISTRY
  WITH_EXECUTOR
  OTHER
}
enum LegalCapacityStatus {
  ASSESSED_COMPETENT
  ASSESSED_INCOMPETENT
  PENDING_ASSESSMENT
  MEDICAL_CERTIFICATION
  COURT_DETERMINATION
  SELF_DECLARATION
}
enum WitnessType {
  REGISTERED_USER
  EXTERNAL_INDIVIDUAL
  PROFESSIONAL_WITNESS    // Lawyer, notary
  COURT_OFFICER
  NOTARY_PUBLIC
}
enum WitnessEligibilityStatus {
  ELIGIBLE
  INELIGIBLE_MINOR
  INELIGIBLE_BENEFICIARY
  INELIGIBLE_SPOUSE
  INELIGIBLE_EXECUTOR
  INELIGIBLE_RELATIONSHIP
  INELIGIBLE_MENTAL_CAPACITY
  INELIGIBLE_CRIMINAL_RECORD
  PENDING_ELIGIBILITY_CHECK
}
enum SignatureType {
  DIGITAL_SIGNATURE
  WET_SIGNATURE
  E_SIGNATURE
  BIOMETRIC_SIGNATURE
  WITNESS_MARK
}
enum AssetType {
  LAND_PARCEL        // Title deeds, subdivision plots
  PROPERTY           // Houses, rentals, buildings
  FINANCIAL_ASSET    // Bank accounts, SACCO shares, investments
  DIGITAL_ASSET      // Crypto, NFTs, online portfolios, social media
  BUSINESS_INTEREST  // Company shares, partnerships, farm ventures
  VEHICLE            // Cars, motorcycles, tractors
  INTELLECTUAL_PROPERTY // Patents, copyrights, trademarks
  LIVESTOCK          // Cattle, goats, poultry
  PERSONAL_EFFECTS   // Jewelry, art, family heirlooms
  OTHER
}
enum AssetOwnershipType {
  SOLE               // Single owner
  JOINT_TENANCY      // Joint owners with right of survivorship
  TENANCY_IN_COMMON  // Shared ownership with separate shares
  COMMUNITY_PROPERTY // Marital property
}
enum AssetVerificationStatus {
  UNVERIFIED
  PENDING_VERIFICATION
  VERIFIED
  REJECTED
  DISPUTED
}
enum AssetEncumbranceType {
  MORTGAGE
  CHARGE
  LIEN
  COURT_ORDER
  FAMILY_CLAIM
  OTHER
}
enum BequestConditionType {
  AGE_REQUIREMENT    // "When beneficiary turns 25"
  SURVIVAL           // "If they survive me by 30 days"
  EDUCATION          // "Upon graduation"
  MARRIAGE           // "Upon marriage"
  ALTERNATE          // "If primary dies, give to alternate"
  NONE
}
enum BequestPriority {
  PRIMARY
  ALTERNATE
  CONTINGENT
}
enum DebtType {
  MORTGAGE
  PERSONAL_LOAN
  CREDIT_CARD
  BUSINESS_DEBT
  TAX_OBLIGATION
  FUNERAL_EXPENSE
  MEDICAL_BILL
  OTHER
}
enum ExecutorAppointmentType {
  TESTAMENTARY            // Appointed by will
  COURT_APPOINTED         // Appointed by court
  ADMINISTRATOR           // Letters of administration
  SPECIAL_EXECUTOR        // For specific purposes
}
enum GiftStatus {
  CONFIRMED
  CONTESTED
  EXCLUDED
  RECLASSIFIED_AS_LOAN
  VOID
}
enum DependantRelationship {
  SPOUSE
  CHILD
  ADOPTED_CHILD
  STEP_CHILD
  PARENT
  SIBLING
  GRANDCHILD
  NIECE_NEPHEW
  OTHER
}
enum DependantStatus {
  DRAFT
  PENDING_VERIFICATION
  VERIFIED
  REJECTED
  APPEALED
  SETTLED
  DISPUTED
}
enum EvidenceType {
  MARRIAGE_CERTIFICATE
  BIRTH_CERTIFICATE
  AFFIDAVIT
  COURT_ORDER
  MEDICAL_REPORT
  OTHER
}
enum RiskLevel {
  LOW
  MEDIUM
  HIGH
}
enum KenyanCounty {
  BARINGO
  BOMET
  BUNGOMA
  BUSIA
  ELGEYO_MARAKWET
  EMBU
  GARISSA
  HOMA_BAY
  ISIOLO
  KAJIADO
  KAKAMEGA
  KERICHO
  KIAMBU
  KILIFI
  KIRINYAGA
  KISII
  KISUMU
  KITUI
  KWALE
  LAIKIPIA
  LAMU
  MACHAKOS
  MAKUENI
  MANDERA
  MARSABIT
  MERU
  MIGORI
  MOMBASA
  MURANGA
  NAIROBI
  NAKURU
  NANDI
  NAROK
  NYAMIRA
  NYANDARUA
  NYERI
  SAMBURU
  SIAYA
  TAITA_TAVETA
  TANA_RIVER
  THARAKA_NITHI
  TRANS_NZOIA
  TURKANA
  UASIN_GISHU
  VIHIGA
  WAJIR
  WEST_POKOT
}
enum NotificationChannel {
  EMAIL
  SMS
}
enum NotificationStatus {
  PENDING
  SENT
  FAILED
}
// ============================================================================
// ACCOUNTS SERVICE MODELS
// Owner: accounts-service
// ============================================================================

model User {
  id              String   @id @default(uuid()) @db.Uuid()
  email           String   @unique(map: "users_email_unique") @db.VarChar(255)
  password        String   @db.VarChar(255) // Argon2id hashed password
  firstName       String   @db.VarChar(100)
  lastName        String   @db.VarChar(100)
  role            UserRole @default(USER)
  isActive        Boolean  @default(true)
  lastLoginAt     DateTime?
  loginAttempts   Int      @default(0)
  lockedUntil     DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?

  // --- Relationships Owned by this Service ---
  profile                UserProfile?
  passwordResetTokens    PasswordResetToken[]
  refreshTokens          RefreshToken[]
  roleChanges            RoleChange[]
  emailVerificationToken EmailVerificationToken?
  phoneVerificationTokens PhoneVerificationToken[]
  emailChangeTokens      EmailChangeToken[]
  loginSessions          LoginSession[]
  passwordHistory        PasswordHistory[]

  // --- Back-relations from other services ---
  documentsUploaded         Document[]              @relation("DocumentUploader") 
  // Back-relations from Family-Service
  createdFamilies     Family[]       @relation("FamilyCreator")
  familyMemberships   FamilyMember[] @relation("FamilyMemberUser")
  // Back-relations from Estate-Service
  
  willsAuthored       Will[] @relation("TestatorWills")
  assetsOwned         Asset[]        @relation("AssetOwner")
  @@index([email, isActive], map: "users_email_isActive_idx")
  @@index([createdAt], map: "users_createdAt_idx")
  @@index([deletedAt], map: "users_deletedAt_idx")
  @@map("users")
}
model UserProfile {
  id            String   @id @default(uuid()) @db.Uuid()
  userId        String   @unique(map: "user_profiles_userId_unique") @db.Uuid()
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  bio            String?   @db.Text
  phoneNumber    String?   @db.VarChar(20)
  phoneVerified  Boolean   @default(false)
  emailVerified  Boolean   @default(false)
  marketingOptIn Boolean   @default(false)
  address        Json?     // {street, city, county, postalCode}
  nextOfKin      Json?     // {name, relationship, phone, email}

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([phoneNumber], map: "user_profiles_phoneNumber_idx")
  @@map("user_profiles")
}
model PasswordResetToken {
  id        String   @id @default(uuid()) @db.Uuid()
  tokenHash String   @unique(map: "password_reset_tokens_tokenHash_unique") @db.VarChar(255)
  expiresAt DateTime
  used      Boolean  @default(false)
  userId    String   @db.Uuid()
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  createdAt DateTime @default(now())

  @@index([userId, used], map: "password_reset_tokens_userId_used_idx")
  @@index([expiresAt], map: "password_reset_tokens_expiresAt_idx")
  @@map("password_reset_tokens")
}
model RefreshToken {
  id        String   @id @default(uuid()) @db.Uuid()
  tokenHash String   @unique(map: "refresh_tokens_tokenHash_unique") @db.VarChar(255)
  expiresAt DateTime
  userId    String   @db.Uuid()
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  deviceId  String?  @db.VarChar(255)
  ipAddress String?  @db.VarChar(45) // IPv6 support
  userAgent String?  @db.Text
  createdAt DateTime @default(now())
  revokedAt DateTime?
  lastUsedAt DateTime?

  @@index([userId], map: "refresh_tokens_userId_idx")
  @@index([expiresAt], map: "refresh_tokens_expiresAt_idx")
  @@map("refresh_tokens")
}
model RoleChange {
  id        String   @id @default(uuid()) @db.Uuid()
  userId    String   @db.Uuid()
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  oldRole   UserRole
  newRole   UserRole
  changedBy String?  @db.Uuid()
  reason    String?  @db.Text
  
  createdAt DateTime @default(now())

  @@index([userId], map: "role_changes_userId_idx")
  @@index([createdAt], map: "role_changes_createdAt_idx")
  @@map("role_changes")
}
model EmailVerificationToken {
  id        String   @id @default(uuid()) @db.Uuid()
  tokenHash String   @unique(map: "email_verification_tokens_tokenHash_unique") @db.VarChar(255)
  expiresAt DateTime
  userId    String   @unique(map: "email_verification_tokens_userId_unique") @db.Uuid()
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  createdAt DateTime @default(now())

  @@index([expiresAt], map: "email_verification_tokens_expiresAt_idx")
  @@map("email_verification_tokens")
}
model PhoneVerificationToken {
  id        String   @id @default(uuid()) @db.Uuid()
  tokenHash String   @unique(map: "phone_verification_tokens_tokenHash_unique") @db.VarChar(255)
  expiresAt DateTime
  userId    String   @db.Uuid()
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  used      Boolean  @default(false)
  attempts  Int      @default(0) // Track verification attempts
  createdAt DateTime @default(now())

  @@index([userId, used], map: "phone_verification_tokens_userId_used_idx")
  @@index([expiresAt], map: "phone_verification_tokens_expiresAt_idx")
  @@map("phone_verification_tokens")
}
model EmailChangeToken {
  id        String   @id @default(uuid()) @db.Uuid()
  userId    String   @db.Uuid()
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  newEmail     String   @db.VarChar(255)
  tokenHash    String   @unique(map: "email_change_tokens_tokenHash_unique") @db.VarChar(255)
  expiresAt    DateTime
  used         Boolean  @default(false)
  createdAt    DateTime @default(now())

  @@index([userId, used], map: "email_change_tokens_userId_used_idx")
  @@index([expiresAt], map: "email_change_tokens_expiresAt_idx")
  @@map("email_change_tokens")
}
model LoginSession {
  id           String    @id @default(uuid()) @db.Uuid()
  userId       String    @db.Uuid()
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  tokenHash    String    @unique(map: "login_sessions_tokenHash_unique") @db.VarChar(255)
  ipAddress    String?   @db.VarChar(45) // IPv6 support
  userAgent    String?   @db.Text
  deviceId     String?   @db.VarChar(255)
  lastActivity DateTime  @default(now())
  expiresAt    DateTime
  revokedAt    DateTime? // For manual session termination
  createdAt    DateTime  @default(now())

  @@index([userId, expiresAt], map: "login_sessions_userId_expiresAt_idx")
  @@index([deviceId], map: "login_sessions_deviceId_idx")
  @@map("login_sessions")
}
model PasswordHistory {
  id           String   @id @default(uuid()) @db.Uuid()
  userId       String   @db.Uuid()
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  passwordHash String   @db.VarChar(255) // Store Argon2id hash of old password
  createdAt    DateTime @default(now())

  @@index([userId, createdAt], map: "password_history_userId_createdAt_idx")
  @@map("password_history")
}
// ============================================================================
// DOCUMENTS SERVICE MODELS
// Owner: documents-service
// ============================================================================
model Document {
  id                  String          @id @default(uuid()) @db.Uuid
  
  // User info
  uploaderId          String          @db.Uuid
  uploader            User            @relation("DocumentUploader", fields: [uploaderId], references: [id])
  documentName        String          @db.VarChar(200)
  // Extracted reference
  referenceNumber     String?         @db.VarChar(100)
  referenceType       ReferenceType?
  
  // Status
  status              DocumentStatus  @default(PENDING_UPLOAD)
  
  // Temporary storage (deleted after verification)
  storageKey          String?         @db.Text
  mimeType            String?         @db.VarChar(100)
  fileSizeBytes       Int?
  
  // Permanent encrypted reference
  encryptedReference  String?         @db.Text
  
  // Verification
  verifiedBy          String?         @db.Uuid
  verifiedAt          DateTime?
  rejectionReason     String?         @db.Text
  
  // OCR
  ocrConfidence       Float?
  ocrExtractedText    String?         @db.Text
  
  // Lifecycle
  uploadedAt          DateTime        @default(now())
  expiresAt           DateTime?
  deletedAt           DateTime?
  
  // Relations
  verificationAttempts VerificationAttempt[]
  assets Asset[]
  wills Will[]
  @@unique([referenceNumber, referenceType])
  @@index([uploaderId, status])
  @@index([status, expiresAt])
  @@map("documents")
}
model VerificationAttempt {
  id          String    @id @default(uuid()) @db.Uuid
  documentId  String    @db.Uuid
  document    Document  @relation(fields: [documentId], references: [id], onDelete: Cascade)
  
  verifierId  String    @db.Uuid
  action      String    @db.VarChar(20) // "APPROVED" or "REJECTED"
  notes       String?   @db.Text
  
  createdAt   DateTime  @default(now())
  
  @@map("verification_attempts")
}
// ============================================================================
// FAMILY-SERVICE SCHEMA
// Purpose: Manages Identity, Kinship, and Legal Authority (Guardianship)
// Context: Kenyan Law (Marriage Act, Children Act, S.40 Succession Act)
// ============================================================================
// ============================================================================
// AGGREGATE ROOT 1: FAMILY
// Manages: Kinship, S.40 Structure, Identity
// ============================================================================
model Family {
  id          String   @id @default(uuid()) @db.Uuid
  
  // Owner (The user who created this family tree)
  creatorId   String   @db.Uuid
  creator     User     @relation("FamilyCreator", fields: [creatorId], references: [id])
  
  // Basic Info
  name        String   @db.VarChar(200) // "The Kamau Family"
  description String?  @db.Text
  
  // Cultural Context (Optional but nice for users)
  homeCounty  KenyanCounty?
  tribe       String?  @db.VarChar(50)
  clanName    String?  @db.VarChar(100)
  
  // Structure Detection (Auto-computed)
  isPolygamous Boolean @default(false)
  totalMembers Int     @default(0) // Denormalized for performance
  totalMinors  Int     @default(0)
  totalSpouses Int     @default(0)
  
  // Smart Features
  hasMissingLinks Boolean @default(false) // "You added children but no mother"
  completenessScore Int   @default(0)     // 0-100, based on required fields filled
  
  // Members
  members     FamilyMember[]
  marriages   Marriage[]
  houses      PolygamousHouse[]
  guardianships Guardianship[]
  
  // Analytics (for dashboard)
  lastActivityAt DateTime @default(now())
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  deletedAt   DateTime? // Soft delete
  
  @@index([creatorId])
  @@map("families")
}

// ============================================================================
// ENTITY: FAMILY MEMBER
// ============================================================================
model FamilyMember {
  id             String   @id @default(uuid()) @db.Uuid
  
  // Family Link
  familyId       String   @db.Uuid
  family         Family   @relation(fields: [familyId], references: [id], onDelete: Cascade)
  
  // Optional User Link (if they register on the platform)
  userId         String?  @unique @db.Uuid
  user           User?    @relation("FamilyMemberUser", fields: [userId], references: [id])
  
  // === CORE IDENTITY ===
  firstName      String   @db.VarChar(100)
  middleName     String?  @db.VarChar(100)
  lastName       String   @db.VarChar(100)
  maidenName     String?  @db.VarChar(100) // For married women
  
  // Relationship to Family Creator
  relationship   RelationshipType
  
  // === DEMOGRAPHICS ===
  gender         Gender?
  dateOfBirth    DateTime?
  placeOfBirth   String?  @db.VarChar(200)
  
  // Kenyan Identity Documents
  nationalId     String?  @unique @db.VarChar(20)
  birthCertNo    String?  @db.VarChar(50)
  kraPin         String?  @db.VarChar(20)
  passportNumber String?  @db.VarChar(50)
  
  // === LIFE STATUS ===
  isAlive        Boolean  @default(true)
  dateOfDeath    DateTime?
  deathCertNo    String?  @db.VarChar(50)
  causeOfDeath   String?  @db.Text
  placeOfDeath   String?  @db.VarChar(200)
  
  // === SPECIAL STATUSES ===
  isMinor        Boolean  @default(false) // Auto-computed: age < 18
  age            Int?                     // Auto-computed from dateOfBirth
  
  // Disability (for dependency assessment)
  hasDisability  Boolean  @default(false)
  disabilityType String?  @db.Text
  
  // Mental Capacity (for guardianship)
  isMentallyCapable Boolean @default(true)
  
  // === ADOPTION ===
  isAdopted      Boolean  @default(false)
  adoptionType   String?  // "LEGAL", "CUSTOMARY"
  adoptionDate   DateTime?
  biologicalParentIds String[] // Array of UUIDs (weak reference)
  
  // === POLYGAMY (Section 40 Logic) ===
  polygamousHouseId String? @db.Uuid
  polygamousHouse   PolygamousHouse? @relation(fields: [polygamousHouseId], references: [id])
  
  // === CONTACT INFO ===
  phoneNumber    String?  @db.VarChar(20)
  email          String?  @db.VarChar(255)
  currentAddress String?  @db.Text
  
  // === VERIFICATION ===
  verificationStatus VerificationStatus @default(UNVERIFIED)
  verifiedAt         DateTime?
  verifiedBy         String?  @db.Uuid // Admin/Verifier ID
  
  // === RELATIONS ===
  // Marriages
  marriagesAsSpouse1 Marriage[] @relation("Spouse1")
  marriagesAsSpouse2 Marriage[] @relation("Spouse2")
  
  // Guardianship
  guardiansAssignedToMe GuardianAssignment[] @relation("Ward")
  guardiansIProvide     GuardianAssignment[] @relation("Guardian")
  
  assets Asset[] @relation("FamilyMemberLifeInterest")
  // === AUDIT ===
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime? // Soft delete
  
  @@index([familyId, relationship])
  @@index([nationalId])
  @@index([isAlive])
  @@map("family_members")
}

// ============================================================================
// ENTITY: MARRIAGE
// ============================================================================
model Marriage {
  id            String   @id @default(uuid()) @db.Uuid
  
  familyId      String   @db.Uuid
  family        Family   @relation(fields: [familyId], references: [id], onDelete: Cascade)
  
  // === SPOUSES ===
  spouse1Id     String   @db.Uuid
  spouse1       FamilyMember @relation("Spouse1", fields: [spouse1Id], references: [id])
  
  spouse2Id     String   @db.Uuid
  spouse2       FamilyMember @relation("Spouse2", fields: [spouse2Id], references: [id])
  
  // === TYPE & STATUS ===
  type          MarriageType
  status        MarriageStatus @default(ACTIVE)
  
  // === DATES ===
  marriageDate  DateTime
  divorceDate   DateTime?
  
  // === POLYGAMY ===
  isPolygamous  Boolean  @default(false)
  marriageOrder Int?     // 1st wife, 2nd wife (only for polygamous)
  
  polygamousHouseId String? @db.Uuid
  polygamousHouse   PolygamousHouse? @relation(fields: [polygamousHouseId], references: [id])
  
  // === REGISTRATION ===
  certNumber    String?  @unique @db.VarChar(100)
  registeredAt  DateTime?
  registryOffice String? @db.VarChar(200)
  
  // === CHILDREN (Denormalized count) ===
  numberOfChildren Int @default(0)
  
  // === VERIFICATION ===
  verificationStatus VerificationStatus @default(UNVERIFIED)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([familyId])
  @@map("marriages")
}

// ============================================================================
// ENTITY: POLYGAMOUS HOUSE (Section 40 - Succession Act)
// ============================================================================
model PolygamousHouse {
  id            String   @id @default(uuid()) @db.Uuid
  
  familyId      String   @db.Uuid
  family        Family   @relation(fields: [familyId], references: [id], onDelete: Cascade)
  
  // === IDENTITY ===
  houseName     String   @db.VarChar(100) // "House of Wanjiku"
  houseOrder    Int      // 1st house, 2nd house, etc.
  houseCode     String   @db.VarChar(20)  // "H1", "H2", etc.
  
  // === MOTHER (The Wife) ===
  motherId      String   @db.Uuid // References FamilyMember
  motherName    String   @db.VarChar(200) // Denormalized for display
  
  // === CHILDREN ===
  // Automatically assigned based on biological mother
  children      FamilyMember[]
  childCount    Int      @default(0) // Denormalized
  
  // === MARRIAGES ===
  marriages     Marriage[]
  
  // === STATUS ===
  isActive      Boolean  @default(true)
  dissolutionDate DateTime?
  dissolutionReason String? @db.Text
  
  // === LEGAL CONTEXT ===
  // For succession: "House of Wanjiku gets X% of estate"
  legalNotes    String?  @db.Text
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@unique([familyId, houseOrder])
  @@map("polygamous_houses")
}

// ============================================================================
// AGGREGATE ROOT: GUARDIANSHIP
// ============================================================================
model Guardianship {
  id          String   @id @default(uuid()) @db.Uuid
  
  // === FAMILY LINK ===
  familyId    String   @db.Uuid
  family      Family   @relation(fields: [familyId], references: [id], onDelete: Cascade)
  
  // === THE MINOR (Ward) ===
  wardId      String   @db.Uuid // References FamilyMember
  wardName    String   @db.VarChar(200) // Denormalized
  wardAge     Int                       // Denormalized
  
  // === STATUS ===
  status      GuardianshipStatus @default(DRAFT)
  
  // === ELIGIBILITY CHECKLIST ===
  // Structure: { isOver18: bool, hasNoCriminalRecord: bool, ... }
  eligibilityChecklist Json?
  
  // === SCORING ===
  eligibilityScore     Int @default(0)  // 0-100
  proximityScore       Int @default(0)  // How close is guardian to ward?
  relationshipScore    Int @default(0)  // How close is relationship?
  overallScore         Int @default(0)  // Weighted average
  
  // === LEGAL COMPLIANCE (Children Act) ===
  legalReference String? @db.Text // "Section 70, Children Act (Cap 141)"
  warnings       String[]         // Array of warning messages
  blockingIssues String[]         // Critical issues preventing approval
  
  // === COURT INFO (Future) ===
  courtOrderNumber String? @db.VarChar(100)
  courtOrderDate   DateTime?
  courtStation     String?  @db.VarChar(200)
  
  // === ASSIGNMENTS ===
  // Can have multiple: primary guardian, alternate guardian
  assignments GuardianAssignment[]
  
  // === COMPLIANCE REPORTS (Future) ===
  // Annual reports required by law
  lastReportDate DateTime?
  nextReportDue  DateTime?
  isCompliant    Boolean @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([familyId])
  @@index([wardId])
  @@map("guardianships")
}

// ============================================================================
// ENTITY: GUARDIAN ASSIGNMENT
// ============================================================================
model GuardianAssignment {
  id              String   @id @default(uuid()) @db.Uuid
  
  // === GUARDIANSHIP ===
  guardianshipId  String   @db.Uuid
  guardianship    Guardianship @relation(fields: [guardianshipId], references: [id], onDelete: Cascade)
  
  // === GUARDIAN (The Adult) ===
  guardianId      String   @db.Uuid
  guardian        FamilyMember @relation("Guardian", fields: [guardianId], references: [id])
  guardianName    String   @db.VarChar(200) // Denormalized
  
  // === WARD (The Minor) ===
  wardId          String   @db.Uuid
  ward            FamilyMember @relation("Ward", fields: [wardId], references: [id])
  
  // === PRIORITY ===
  isPrimary       Boolean  @default(false)
  isAlternate     Boolean  @default(false)
  priorityOrder   Int      @default(1) // 1st choice, 2nd choice, etc.
  
  // === STATUS ===
  isActive        Boolean  @default(true)
  
  // === ELIGIBILITY (Snapshot) ===
  // Stored at time of assignment
  eligibilitySnapshot Json?
  eligibilityScore    Int @default(0)
  
  // === DATES ===
  appointedDate   DateTime @default(now())
  activatedDate   DateTime?
  suspendedDate   DateTime?
  terminatedDate  DateTime?
  
  // === TERMINATION ===
  terminationReason String? @db.Text
  
  // === LEGAL ===
  courtApproved   Boolean @default(false)
  courtOrderRef   String? @db.VarChar(100)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@unique([guardianshipId, guardianId]) // One assignment per guardian per guardianship
  @@index([guardianId])
  @@index([wardId])
  @@map("guardian_assignments")
}
// ============================================================================
// ESTATE-SERVICE MODELS
// Purpose: Manages the Inventory (Estate) and Instructions (Will).
// Strict Boundaries: No Court Processes, No Grants, No Transmissions.
// ============================================================================
// =============================================================================
// 1. ESTATE (THE ECONOMIC TRUTH ENGINE)
// =============================================================================
model Estate {
  id          String   @id @default(uuid()) @db.Uuid
  
  // --- Owner ---
  userId      String   @unique @db.Uuid
  userName    String   // Denormalized for display
  kraPin      String?  @db.VarChar(20)
  
  // --- Net Worth Calculation (Auto-computed) ---
  totalAssets Decimal  @default(0) @db.Decimal(15, 2)
  totalDebts  Decimal  @default(0) @db.Decimal(15, 2)
  netWorth    Decimal  @default(0) @db.Decimal(15, 2)
  
  // --- Status Flags ---
  isInsolvent Boolean  @default(false) // Debts > Assets
  
  // --- Relations ---
  assets      Asset[]
  debts       Debt[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  readinessAssessments ReadinessAssessment[]
  @@map("estates")
}
// =============================================================================
// 2. ASSET (WHAT YOU OWN)
// =============================================================================
model Asset {
  id          String   @id @default(uuid()) @db.Uuid
  
  // --- Owner ---
  estateId    String   @db.Uuid
  estate      Estate   @relation(fields: [estateId], references: [id], onDelete: Cascade)
  
  // --- Basic Info ---
  name        String   @db.VarChar(200)
  description String?  @db.Text
  category    AssetCategory
  status      AssetStatus @default(ACTIVE)
  
  // --- Value ---
  estimatedValue Decimal  @db.Decimal(15, 2)
  currency       String   @default("KES")
  
  // --- Verification ---
  isVerified     Boolean  @default(false)
  proofDocumentUrl String? // Link to uploaded doc (title deed, logbook, etc)
  
  // --- Encumbrance ---
  isEncumbered   Boolean  @default(false)
  encumbranceDetails String? @db.Text // "Mortgage of KES 2M with Equity Bank"
  
  // --- Category-Specific Details ---
  landDetails    LandDetails?
  vehicleDetails VehicleDetails?
  
  // --- Metadata ---
  purchaseDate   DateTime?
  location       String?  @db.VarChar(200)
  
  // --- Relations ---
  bequests       Bequest[] // Who gets this in the will
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  users User[] @relation("AssetOwner")
  documents Document[]
  familyMembers FamilyMember[] @relation("FamilyMemberLifeInterest")
  @@index([estateId, category])
  @@map("assets")
}

// --- LAND SPECIFIC DETAILS ---
model LandDetails {
  id              String   @id @default(uuid()) @db.Uuid
  assetId         String   @unique @db.Uuid
  asset           Asset    @relation(fields: [assetId], references: [id], onDelete: Cascade)
  
  titleDeedNumber String   @db.VarChar(100)
  parcelNumber    String?  @db.VarChar(100)
  county          KenyanCounty
  subCounty       String?  @db.VarChar(100)
  landCategory    LandCategory
  sizeInAcres     Decimal? @db.Decimal(10, 2)
  
  @@map("land_details")
}

// --- VEHICLE SPECIFIC DETAILS ---
model VehicleDetails {
  id                 String   @id @default(uuid()) @db.Uuid
  assetId            String   @unique @db.Uuid
  asset              Asset    @relation(fields: [assetId], references: [id], onDelete: Cascade)
  
  registrationNumber String   @db.VarChar(20)
  make               String   @db.VarChar(100)
  model              String   @db.VarChar(100)
  year               Int?
  vehicleCategory    VehicleCategory
  
  @@map("vehicle_details")
}
// =============================================================================
// 3. DEBT (WHAT YOU OWE)
// =============================================================================
model Debt {
  id                String   @id @default(uuid()) @db.Uuid
  
  // --- Owner ---
  estateId          String   @db.Uuid
  estate            Estate   @relation(fields: [estateId], references: [id], onDelete: Cascade)
  
  // --- Creditor ---
  creditorName      String   @db.VarChar(200)
  creditorContact   String?  @db.VarChar(100)
  
  // --- Details ---
  description       String   @db.Text
  category          DebtCategory
  priority          DebtPriority
  status            DebtStatus @default(OUTSTANDING)
  
  // --- Amounts ---
  originalAmount    Decimal  @db.Decimal(15, 2)
  outstandingBalance Decimal @db.Decimal(15, 2)
  currency          String   @default("KES")
  
  // --- Dates ---
  dueDate           DateTime?
  
  // --- Security ---
  isSecured         Boolean  @default(false)
  securityDetails   String?  @db.Text // "Secured against plot in Kiambu"
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@index([estateId, priority])
  @@map("debts")
}
// =============================================================================
// 4. WILL (THE INSTRUCTIONS)
// =============================================================================
model Will {
  id              String   @id @default(uuid()) @db.Uuid
  
  // --- Testator (The Person Making the Will) ---
  userId          String   @db.Uuid
  testatorName    String   @db.VarChar(200)
  
  // --- Status ---
  status          WillStatus @default(DRAFT)
  versionNumber   Int        @default(1)
  
  // --- Executor (Who Will Execute the Will) ---
  executorName    String?   @db.VarChar(200)
  executorPhone   String?   @db.VarChar(20)
  executorEmail   String?   @db.VarChar(100)
  executorRelationship String? // "Son", "Daughter", "Lawyer", etc
  
  // --- Special Instructions ---
  funeralWishes   String?   @db.Text
  burialLocation  String?   @db.VarChar(200)
  specialInstructions String? @db.Text
  
  // --- Completeness Tracking ---
  hasExecutor     Boolean   @default(false)
  hasBeneficiaries Boolean  @default(false)
  hasWitnesses    Boolean   @default(false)
  isComplete      Boolean   @default(false)
  completenessScore Int     @default(0) // 0-100
  
  // --- Validation Warnings ---
  validationWarnings String[] // ["Need 2 witnesses", "No beneficiaries added"]
  
  // --- Relations ---
  bequests        Bequest[]
  witnesses       Witness[]
  users User[] @relation("TestatorWills")
  documents Document[]
  // --- Dates ---
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  executedAt      DateTime? // When person dies
  
  @@index([userId, status])
  @@map("wills")
}
// =============================================================================
// 5. BEQUEST (WHO GETS WHAT)
// =============================================================================
model Bequest {
  id              String   @id @default(uuid()) @db.Uuid
  
  // --- Will Link ---
  willId          String   @db.Uuid
  will            Will     @relation(fields: [willId], references: [id], onDelete: Cascade)
  
  // --- Asset Link (Optional) ---
  assetId         String?  @db.Uuid
  asset           Asset?   @relation(fields: [assetId], references: [id])
  
  // --- Beneficiary ---
  beneficiaryName String   @db.VarChar(200)
  beneficiaryType BeneficiaryType
  relationship    String?  @db.VarChar(100)
  
  // --- What They Get ---
  bequestType     BequestType
  percentage      Decimal? @db.Decimal(5, 2) // For percentage-based
  cashAmount      Decimal? @db.Decimal(15, 2) // For cash bequests
  description     String   @db.Text // Human-readable description
  
  // --- Conditions ---
  hasConditions   Boolean  @default(false)
  conditions      String?  @db.Text // "Only if they graduate university"
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([willId])
  @@map("bequests")
}
// =============================================================================
// 6. WITNESS (LEGAL REQUIREMENT)
// =============================================================================
model Witness {
  id              String   @id @default(uuid()) @db.Uuid
  
  // --- Will Link ---
  willId          String   @db.Uuid
  will            Will     @relation(fields: [willId], references: [id], onDelete: Cascade)
  
  // --- Witness Details ---
  fullName        String   @db.VarChar(200)
  nationalId      String?  @db.VarChar(20)
  phoneNumber     String?  @db.VarChar(20)
  email           String?  @db.VarChar(100)
  address         String?  @db.Text
  
  // --- Status ---
  status          WitnessStatus @default(PENDING)
  signedAt        DateTime?
  
  // --- Eligibility Checks ---
  isOver18        Boolean  @default(true)
  isNotBeneficiary Boolean @default(true)
  isMentallyCapable Boolean @default(true)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([willId])
  @@map("witnesses")
}
// ============================================================================
// SUCCESSION-AUTOMATION SERVICE
// Purpose: "The Digital Lawyer". Generates forms, tracks readiness, guides the user.
// Updates: Includes SuccessionContext and RiskSource for traceability.
// ============================================================================
// =============================================================================
// AGGREGATE 1: READINESS ASSESSMENT
// Purpose: Analyzes Family + Estate to tell user if they are ready to go to court.
// =============================================================================
model ReadinessAssessment {
  id                  String   @id @default(uuid()) @db.Uuid()
  // --- Target Identification ---
  estateId            String   @unique @db.Uuid() 
  estate              Estate   @relation(fields: [estateId], references: [id], onDelete: Cascade)
  familyId            String?  @db.Uuid() // Optional link for context 
  contextRegime             SuccessionRegime
  contextMarriage           SuccessionMarriageType
  contextReligion           SuccessionReligion
  // Critical Context Flags (Stored for fast querying/indexing)
  isMinorInvolved              Boolean @default(false)
  hasDisputedAssets            Boolean @default(false)
  isBusinessAssetsInvolved     Boolean @default(false)
  isForeignAssetsInvolved      Boolean @default(false)
  isEstateInsolvent            Boolean @default(false)
  hasDependantsWithDisabilities Boolean @default(false)
  // Derived Context properties
  targetCourtJurisdiction   CourtJurisdiction
  estimatedComplexityScore  Int      @default(1) // 1-10
  readinessScore      Int               @default(0) // 0-100%
  status              ReadinessStatus   @default(IN_PROGRESS)
  filingConfidence    FilingConfidence  @default(LOW)
  // Stores { critical: Int, high: Int, medium: Int, low: Int }
  riskBreakdown       Json 
  nextMilestone       String?
  estimatedDaysToReady Int?
  // Stores DocumentGap[] as JSON (Transient/UI state)
  missingDocuments    Json?
  // Stores blocking issues as String[]
  blockingIssues      String[]
  // The generated advice string
  recommendedStrategy String? @db.Text  
  // --- Lifecycle & Audit ---
  lastAssessedAt           DateTime @default(now())
  lastRecalculationTrigger String?  @db.VarChar(100) // e.g., "manual_update", "asset_verified"
  totalRecalculations      Int      @default(0)
  // Completion Logic
  isComplete          Boolean  @default(false)
  completedAt         DateTime?
  // Optimistic Concurrency
  version             Int      @default(1)
  // --- Child Entities ---
  riskFlags           RiskFlag[]
  
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  @@map("readiness_assessments")
}
model RiskFlag {
  id              String   @id @default(uuid()) @db.Uuid()
  assessmentId    String   @db.Uuid()
  assessment      ReadinessAssessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
  // --- Core Risk Info ---
  severity        RiskSeverity
  category        RiskCategory
  riskStatus      RiskStatus   @default(ACTIVE)
  description     String   @db.Text
  legalBasis      String   @db.Text // "S.56 LSA - Death Certificate mandatory"
  // Mitigation steps stored as Postgres Array
  mitigationSteps String[] 
  sourceType          RiskSourceType
  serviceName         String   // e.g., "family-service"
  detectionMethod     DetectionMethod
  detectionRuleId     String   // e.g., "RULE_DEATH_CERT_REQUIRED"
  // Weak References (Traceability)
  sourceEntityId      String?  
  sourceEntityType    String?  
  sourceAggregateId   String?  
  // Complex Source Data (LegalReferences[], confidenceScore, etc.)
  sourceDetails       Json? 
  isBlocking          Boolean  @default(false)
  impactScore         Int      @default(0) // 1-10
  // Scope: IDs of things affected by this risk (Postgres Arrays)
  affectedEntityIds    String[]
  affectedAggregateIds String[]
  // Linked Document Gap (Value Object as JSON)
  documentGap          Json? 
  expectedResolutionEvents String[]
  autoResolveTimeout       DateTime?
  // Resolution State
  isResolved           Boolean   @default(false) // Derived/Cached from status
  resolvedAt           DateTime?
  resolutionMethod     ResolutionMethod?
  resolvedBy           String?   // "system" or User ID
  resolutionNotes      String?   @db.Text
  // --- Review Metadata ---
  lastReviewedAt       DateTime  @default(now())
  reviewCount          Int       @default(0)
  
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  @@index([sourceEntityId, sourceType])
  @@index([category, riskStatus])
  @@map("risk_flags")
}
// =============================================================================
// AGGREGATE 2: PROBATE APPLICATION (The Generator)
// Purpose: Compiles the "Bundle" for court based on the Context.
// =============================================================================

model ProbateApplication {
  id                  String   @id @default(uuid()) @db.Uuid()
  estateId            String   @db.Uuid()
  readinessAssessmentId String @db.Uuid() // Link to the assessment that authorized this
  successionContext   Json 
  readinessScore      Json?
  // --- Core Details ---
  applicationType     ProbateApplicationType
  status              ApplicationStatus       @default(DRAFT)
  priority            FilingPriority          @default(NORMAL)
  // --- Applicant Details ---
  applicantUserId       String   @db.Uuid()
  applicantFullName     String
  applicantRelationship String
  applicantContact      Json     // { phone, email, physicalAddress }
  // --- Court Interaction ---
  targetCourtJurisdiction CourtJurisdiction
  targetCourtName         String   @db.VarChar(150)
  courtStation            String   @db.VarChar(100)
  courtRegistry           String?
  estimatedProcessingDays Int?
  // --- Financials ---
  filingFeeAmount         Decimal  @default(0) @db.Decimal(19, 4)
  filingFeePaid           Boolean  @default(false)
  filingFeePaidAt         DateTime?
  // --- Timeline & Dates ---
  estimatedFilingDate     DateTime?
  estimatedGrantDate      DateTime?
  // --- Filing Records ---
  filedAt                 DateTime?
  filingMethod            String?  // 'E_FILING', 'PHYSICAL', etc.
  courtCaseNumber         String?  @db.VarChar(100)
  courtFileNumber         String?
  courtReceiptNumber      String?
  // --- Court Response ---
  courtReviewDate         DateTime?
  gazettePublishedDate    DateTime?
  gazetteNoticeId         String?
  objectionDeadline       DateTime?
  // --- Grant Issuance ---
  grantedDate             DateTime?
  grantNumber             String?
  grantType               String?
  grantIssuedBy           String?
  // --- Rejection & Withdrawal ---
  rejectionReason         String?   @db.Text
  rejectionDate           DateTime?
  amendmentsRequired      String[]  // Postgres Array
  amendmentDeadline       DateTime?
  withdrawnAt             DateTime?
  withdrawalReason        String?
  // --- Analytics & Metadata ---
  totalFormsGenerated     Int       @default(0)
  totalConsentsRequired   Int       @default(0)
  lastStatusChangeAt      DateTime  @default(now())
  notes                   String?   @db.Text
  internalNotes           String?   @db.Text
  version                 Int       @default(1)
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  // --- Child Entities ---
  generatedForms          GeneratedForm[]
  familyConsents          FamilyConsent[]

  @@index([estateId, status])
  @@index([courtCaseNumber])
  @@map("probate_applications")
}

model GeneratedForm {
  id              String   @id @default(uuid()) @db.Uuid()
  applicationId   String   @db.Uuid()
  application     ProbateApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  // --- Identity ---
  formType        KenyanFormType // Using the exact Enum from VO
  formCode        String             @db.VarChar(50) // e.g., "P&A 1"
  displayName     String
  // --- Lifecycle ---
  status          FormStatus      @default(PENDING_GENERATION)
  currentVersion  Int             @default(0)
  // --- Storage ---
  storageProvider StorageProvider @default(AWS_S3)
  storageUrl      String          @db.Text
  fileFormat      FileFormat      @default(PDF)
  fileSizeBytes   Int             @default(0)
  checksum        String?
  // --- Content Source ---
  templateVersion String?
  dataSource      String?         // e.g., 'estate-service'
  dataHash        String?
  // --- Signatures (Complex JSON) ---
  // Stores array of FormSignature: 
  // [{ signatoryId, signatureType, signedAt, witnessName... }]
  signatures      Json?           
  requiredSignatories Int         @default(0)
  isFullySigned       Boolean     @default(false)
  // --- Filing Metadata ---
  courtCaseNumber     String?
  filingDate          DateTime?
  filingReference     String?
  courtStampNumber    String?
  // --- Rejections & Amendments ---
  rejectionReason     String?     @db.Text
  courtQueries        String[]    
  amendmentsRequired  String[]
  // --- Version History (Complex JSON) ---
  // Stores array of FormVersion:
  // [{ versionNumber, generatedAt, storageUrl, checksum... }]
  versions            Json?
  // --- Review Process ---
  generatedBy         String?     // 'system' or UserID
  generatedAt         DateTime    @default(now())
  reviewedBy          String?     @db.Uuid()
  reviewedAt          DateTime?
  reviewNotes         String?
  // --- Metadata ---
  pageCount                   Int     @default(0)
  isNotarizationRequired      Boolean @default(false)
  isCommissionerOathsRequired Boolean @default(false)
  isCourtStampRequired        Boolean @default(false)
  relatedFormIds      String[]    // IDs of related forms
  dependsOnFormIds    String[]    // IDs of prerequisite forms
  // --- Access Log ---
  lastAccessedAt      DateTime?
  accessCount         Int         @default(0)
  updatedAt           DateTime    @updatedAt  
  
  @@map("generated_forms")
}
model FamilyConsent {
  id              String   @id @default(uuid()) @db.Uuid()
  applicationId   String   @db.Uuid()
  application     ProbateApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  // --- Identity ---
  familyMemberId  String   @db.Uuid() // Link to FamilyMember
  fullName        String
  nationalId      String?
  phoneNumber     String?
  email           String?
  // --- Role ---
  role                   FamilyRole
  relationshipToDeceased String
  // --- Status ---
  status          ConsentStatus @default(PENDING)
  method          ConsentMethod?
  // --- Request Tracking ---
  requestSentAt   DateTime?
  requestSentVia  String?    // 'SMS', 'EMAIL', 'BOTH'
  requestExpiresAt DateTime?
  // --- Response Tracking ---
  respondedAt     DateTime?
  consentGivenAt  DateTime?
  declinedAt      DateTime?
  withdrawnAt     DateTime?
  // --- Evidence ---
  digitalSignatureId String?
  signatureMethod    ConsentMethod?
  verificationCode   String?      // OTP used
  ipAddress          String?
  deviceInfo         String?
  // --- Decline/Withdrawal Logic ---
  declineReason      String?      @db.Text
  declineCategory    String?      // 'DISPUTE', 'NOT_INFORMED', etc.
  withdrawalReason   String?      @db.Text
  // --- Legal Rep ---
  hasLegalRepresentative     Boolean @default(false)
  legalRepresentativeName    String?
  legalRepresentativeContact String?
  // --- Notes ---
  notes           String?      @db.Text
  internalNotes   String?      @db.Text
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@unique([applicationId, familyMemberId]) // One consent per member per application
  @@map("family_consents")
}
// =============================================================================
// AGGREGATE ROOT: EXECUTOR ROADMAP
// Purpose: AI-Powered Legal GPS System. Manages the execution workflow.
// =============================================================================
model ExecutorRoadmap {
  id                  String   @id @default(uuid()) @db.Uuid()
  // --- Target & Context ---
  estateId            String   @unique @db.Uuid()
  readinessAssessmentId String @db.Uuid()
  // Snapshot of context at creation/regeneration (Json)
  successionContext   Json
  readinessScore      Json?
  // --- Current State ---
  currentPhase        RoadmapPhase   @default(PRE_FILING)
  status              RoadmapStatus  @default(DRAFT)
  percentComplete     Int            @default(0)
  // --- Phase Tracking (Complex JSON) ---
  // Stores Map<RoadmapPhase, PhaseProgress>
  phases              Json
  // Stores PhaseHistory[]
  phaseHistory        Json
  // --- Counters ---
  totalTasks          Int      @default(0)
  completedTasks      Int      @default(0)
  skippedTasks        Int      @default(0)
  overdueTasks        Int      @default(0)
  blockedTasks        Int      @default(0)
  // --- Time Tracking ---
  startedAt               DateTime  @default(now())
  estimatedCompletionDate DateTime?
  actualCompletionDate    DateTime?
  totalTimeSpentHours     Float     @default(0)
  // --- Risk Integration (Arrays of IDs) ---
  blockedByRiskIds    String[]
  resolvesRiskIds     String[]
  linkedDocumentGaps  String[]
  // --- Analytics (JSON) ---
  analytics           Json
  // --- User Progress ---
  userId              String    @db.Uuid()
  executorName        String
  lastActiveAt        DateTime  @default(now())
  daysInactive        Int       @default(0)
  // --- Automation Settings ---
  autoTransitionEnabled     Boolean @default(true)
  autoTaskGenerationEnabled Boolean @default(true)
  escalationThresholdDays   Int     @default(14)
  // --- Metadata ---
  version             Int       @default(1)
  lastOptimizedAt     DateTime?
  optimizationCount   Int       @default(0)
  notes               String?   @db.Text
  internalNotes       String?   @db.Text
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  // --- Child Entities ---
  tasks               RoadmapTask[]

  @@map("executor_roadmaps")
}
model RoadmapTask {
  id                  String   @id @default(uuid()) @db.Uuid()
  roadmapId           String   @db.Uuid()
  roadmap             ExecutorRoadmap @relation(fields: [roadmapId], references: [id], onDelete: Cascade)
  // --- Identity ---
  title               String
  description         String   @db.Text
  shortCode           String   @db.VarChar(50) // e.g. "DOC-001"
  category            TaskCategory
  priority            TaskPriority
  status              TaskStatus @default(PENDING)
  // --- Ordering ---
  phase               RoadmapPhase
  orderIndex          Int
  // --- Dependencies (Arrays of IDs) ---
  dependsOnTaskIds    String[]
  blocksTaskIds       String[]
  // --- Logic & Triggers ---
  applicableContexts  String[]
  triggers            TaskTrigger[]
  legalReferences     Json     // Stores LegalReference[]
  // --- Instructions & Content ---
  detailedInstructions String[]
  quickTips            String[]
  commonMistakes       String[]
  externalLinks        Json     // Stores ExternalLink[]
  courtSpecificInstructions Json? // Map<Jurisdiction, Instruction>
  // --- Proof Requirements ---
  requiresProof        Boolean   @default(false)
  proofTypes           ProofType[]
  proofDocumentType    String?   // Mapped to DocumentGapType enum string
  // --- Timing ---
  dueDate              DateTime?
  startDate            DateTime?
  endDate              DateTime?
  startedAt            DateTime?
  completedAt          DateTime?
  skippedAt            DateTime?
  lastRemindedAt       DateTime?
  estimatedTimeMinutes Int       @default(0)
  timeSpentMinutes     Int       @default(0)
  // --- Status Details ---
  completedBy          String?   // User ID
  completionNotes      String?   @db.Text
  skipReason           String?   @db.Text
  waiverReason         String?   @db.Text
  failureReason        String?   @db.Text
  isOverdue            Boolean   @default(false)
  // --- Retry & Escalation ---
  retryCount           Int       @default(0)
  lastAttemptedAt      DateTime?
  reminderIntervalDays Int       @default(7)
  escalationLevel      Int       @default(0)
  autoEscalateAfterDays Int      @default(14)
  // --- Integration & Metadata ---
  relatedRiskFlagIds    String[]
  relatedDocumentGapIds String[]
  externalServiceId     String?
  externalTaskId        String?
  history               Json     // Stores TaskHistoryEntry[]
  templateVersion       String?
  tags                  String[]
  // --- Audit ---
  createdBy             String?
  lastModifiedBy        String?
  lastModifiedAt        DateTime @default(now())
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@index([roadmapId, status])
  @@index([category])
  @@index([priority, isOverdue])
  @@map("roadmap_tasks")
}
